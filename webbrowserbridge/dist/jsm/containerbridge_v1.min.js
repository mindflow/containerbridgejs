import{Logger as e,TimePromise as t}from"./coreutil_v1.js";class s{static timeout(e,t){return new Promise((function(s,n){setTimeout((function(){n(new Error("timeout"))}),e),t.then(s,n)}))}static delay(e,t){return setTimeout(t,e)}static pause(e){return new Promise((t=>{setTimeout((()=>{t()}),e)}))}}class n{static async store(e,t){if(window.PasswordCredential){const s=new PasswordCredential({id:e,password:t}),n=await navigator.credentials.store(s);return LOG.info(n),n}return null}}class r{static open(e,t){return window.indexedDB.open(e,t)}}class i{constructor(e){this.text=e}get value(){return this.text.nodeValue}set value(e){this.text.nodeValue=e}}class a{constructor(e){this.file=e,this.uploadPercentage=0,this.uploadComplete=!1}get name(){return this.file.name}get size(){return this.file.size}get type(){return this.file.type}get lastModified(){return this.file.lastModified}async toArrayBuffer(){return await this.file.arrayBuffer()}async toBase64(){const e=await this.toArrayBuffer();return btoa(String.fromCharCode(...new Uint8Array(e)))}}new e("ContainerElement");class l{static getElementById(e){return new u(document.getElementById(e))}static createTextNode(e){return new i(document.createTextNode(e))}static createElement(e){return new u(document.createElement(e))}static removeElement(e){const t=document.getElementById(e);t.parentNode.removeChild(t)}static createElementNS(e,t){return new u(document.createElementNS(e,t))}static appendRootUiChild(e){document.getElementsByTagName("body")[0].appendChild(e.element)}static appendRootMetaChild(e){document.getElementsByTagName("head")[0].appendChild(e.element)}static setAttributeValue(e,t,s){e.setAttributeValue(t,s)}static getAttributeValue(e,t){return e.getAttributeValue(t)}static contains(e,t){return e.contains(t)}static isConnected(e){return e.isConnected}static isUIElement(e){return e instanceof HTMLElement}static scrollLockTo(e,s,n,r){const i=e=>{e.target.scrollTo(s,n)};e.addEventListener("scroll",i),t.asPromise(r,(()=>{e.removeEventListener("scroll",i)}))}static toFileDataArray(e){const t=[];for(const s of e)t.push(new a(s));return t}}class o{constructor(e){this.event=e,"dragstart"==this.event.type.toLowerCase()&&this.event.dataTransfer.setData("text/plain",null)}stopPropagation(){this.event.stopPropagation()}preventDefault(){this.event.preventDefault()}get files(){if(this.event.target&&this.event.target.files){const e=this.event.target;return l.toFileDataArray(e.files)}if(this.event.dataTransfer){const e=this.event.dataTransfer;if(e.files)return l.toFileDataArray(e.files)}return[]}get offsetX(){return this.event.offsetX}get offsetY(){return this.event.offsetY}get clientX(){return this.event.clientX}get clientY(){return this.event.clientY}get target(){if(this.event&&this.event.target)return new u(this.event.target)}get relatedTarget(){return this.event&&this.event.relatedTarget?new u(this.event.relatedTarget):null}getRelatedTargetAttribute(e){return this.event.relatedTarget?new u(this.event.relatedTarget).getAttributeValue(e):null}get targetValue(){return this.target?this.target.value:null}get keyCode(){return this.event.keyCode}isKeyCode(e){return this.event.keyCode===e}}class u{constructor(e){this.element=e}contains(e){return this.element.contains(e.element)}getAttributeValue(e){return this.element.getAttribute(e)}setAttributeValue(e,t){this.element.setAttribute(e,t)}removeAttribute(e){this.element.removeAttribute(e)}hasAttribute(e){return this.element.hasAttribute(e)}get id(){return this.getAttributeValue("id")}get className(){return this.getAttributeValue("class")}get innerText(){return this.element.innerText}set innerText(e){this.element.innerText=e}get innerHTML(){return this.element.innerHTML}set innerHTML(e){this.element.innerHTML=e}get value(){return this.element.value}set value(e){this.element.value=e}get disabled(){return this.element.disabled}set disabled(e){this.element.disabled=e}get style(){return this.element.style}set style(e){this.element.style=e}get isConnected(){return this.element.isConnected}addEventListener(e,t,s){this.element.addEventListener(e,(e=>{t.call(new o(e))}),s)}get name(){return this.element.name}set name(e){this.element.name=e}get type(){return this.element.type}set type(e){this.element.type=e}get text(){return this.element.text}set text(e){this.element.text=e}get tagName(){return this.element.tagName}get offsetWidth(){return this.element.offsetWidth}get offsetHeight(){return this.element.offsetHeight}get boundingClientRect(){return this.element.getBoundingClientRect()}get parentNode(){return this.element.parentNode?new u(this.element.parentNode):null}appendChild(e){e instanceof u&&this.element.appendChild(e.element),e instanceof i&&this.element.appendChild(e.text)}removeChild(e){this.element.removeChild(e.element)}replaceChild(e,t){this.element.replaceChild(e.element,t.element)}get firstChild(){return this.element.firstChild?new u(this.element.firstChild):null}get lastChild(){return this.element.lastChild?new u(this.element.lastChild):null}focus(){this.element.focus()}select(){this.element.select&&this.element.select()}get checked(){return this.element.checked}set checked(e){this.element.checked=e}submit(){if(this.element.submit)return this.element.submit()}click(){this.element.click()}dispatchEvent(e){return this.element.dispatchEvent(new InputEvent(e))}playMuted(){return this.element.play?(this.element.muted=!0,this.element.play()):null}mute(){this.element.mute&&(this.element.muted=!0)}unmute(){this.element.unmute&&(this.element.muted=!1)}play(){return this.element.play?this.element.play():null}pause(){return this.element.pause?this.element.pause():null}}class c{constructor(e,t,s,n,r,i){this.jsonFunction=e,this.textFunction=t,this.statusValue=s,this.statusTextValue=n,this.headersValue=r,this.okValue=i}async json(){return await this.jsonFunction.call()}async text(){return await this.textFunction.call()}get status(){return this.statusValue}get statusText(){return this.statusTextValue}get headers(){return this.headersValue}get ok(){return this.okValue}static async _fromResponse(e){const t=await e,s=new Map;for(const e of t.headers.entries())s.set(e[0],e[1]);return new c((()=>t.json()),(()=>t.text()),t.status,t.statusText,s,t.ok)}static async _fromXhr(e,t){const s=new Promise(((s,n)=>{e.onload=()=>{e.status>=200&&e.status<300?(t.call([100]),s(e.response)):n(e.response)},e.ontimeout=()=>{n("Request timed out")}})),n=e.getAllResponseHeaders(),r=new Map;if(n){const e=n.split("\r\n");for(const t of e){const e=t.indexOf(": ");if(e>0){const s=t.substring(0,e),n=t.substring(e+2);r.set(s,n)}}}return await s,new c((()=>new Promise(((e,t)=>{s.then((t=>{e(JSON.parse(t))})).catch((e=>{t(e)}))}))),(()=>new Promise(((e,t)=>{s.then((t=>{e(t)})).catch((e=>{t(e)}))}))),e.status,e.statusText,r,e.status>=200&&e.status<300)}}class h{constructor(){this.filesMap=new Map,this.parameterMap=new Map}static fromFiles(e){const t=new h;for(const s of e)t.withFile(s.name,s);return t}withFile(e,t){return this.filesMap.set(e,t),this}withParameter(e,t){return this.parameterMap.set(e,t),this}_asFormData(){const e=new FormData;for(const t of this.filesMap.values())e.append("file",t.file,t.name);if(this.parameterMap.size>0)for(const t of this.parameterMap.keys())e.append(t,this.parameterMap.get(t));return e}get files(){return Array.from(this.filesMap.values())}}new e("ContainerHttpClient");class m{static async fetch(e,t,s=4e3){const n=fetch(e,t);return c._fromResponse(n,s)}static async xhr(e,t,s,n=null,r=null,i=4e3){const a=new XMLHttpRequest;a.open(e,t,!0),a.timeout=i,a.setRequestHeader("Accept","application/json"),n&&a.setRequestHeader("Authorization",n),a.onprogress=e=>{r.call([Math.round(e.loaded/e.total*100)])},a.ontimeout=()=>Promise.reject("Request timed out");const l=s._asFormData();return a.send(l),c._fromXhr(a,r)}callProgressCallbackMethod(e,t,s){e&&e.call(t,s)}}class d{static setLocalAttribute(e,t){window.localStorage.setItem(e,t)}static removeLocalAttribute(e){window.localStorage.removeItem(e)}static hasLocalAttribute(e){return null!==window.localStorage.getItem(e)}static getLocalAttribute(e){return window.localStorage.getItem(e)}}new e("ContainerSessionStorage");class g{static setSessionAttribute(e,t){window.sessionStorage.setItem(e,t)}static removeSessionAttribute(e){window.sessionStorage.removeItem(e)}static getSessionAttribute(e){return window.sessionStorage.getItem(e)}static hasSessionAttribute(e){return null!==window.sessionStorage.getItem(e)}static setLocalAttribute(e,t){window.localStorage.setItem(e,t)}}class p{static addEventListener(e,t){const s=e=>{t.call(new o(e))};return window.addEventListener(e,s),()=>{window.removeEventListener(e,s)}}}new e("ContainerUrl");class f{static go(e){window.location=e}static back(){window.history.back()}static replaceUrl(e,t,s){window.history.replaceState(s,t,e)}static pushUrl(e,t,s){window.history.pushState(s,t,e)}static currentUrl(){return window.location.href}static addUserNavigateListener(e){p.addEventListener("popstate",e)}}export{s as ContainerAsync,n as ContainerCredentialsStorage,r as ContainerDatabaseStorage,u as ContainerElement,l as ContainerElementUtils,o as ContainerEvent,a as ContainerFileData,m as ContainerHttpClient,c as ContainerHttpResponse,d as ContainerLocalStorage,g as ContainerSessionStorage,i as ContainerText,h as ContainerUploadData,f as ContainerUrl,p as ContainerWindow};
